{% extends 'components/base.html' %}
{% load static %}
{% load i18n %}

{% block styles %}
{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- Page Header -->
  <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
    <h1 class="page-title fw-semibold fs-18 mb-2 mb-md-0">{% trans "Detalles de Gastos" %}</h1>
    <div class="ms-md-1 ms-0">
      <nav>
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="{% url 'app:index' %}">{% trans "Dashboard" %}</a></li>
          <li class="breadcrumb-item"><a href="{% url 'app:list_bills' %}">{% trans "Gastos" %}</a></li>
          <li class="breadcrumb-item active" aria-current="page">{% trans "Detalles" %}</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Transaction List -->
  <div class="card custom-card">
    <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
      <div class="card-title mb-2 mb-sm-0">{% trans "Lista de Gastos" %}</div>
      <span class="badge bg-primary-transparent">{% trans "Total:" %} {{ paginator.count|default:bills.count }}</span>
    </div>
    <div class="card-body p-2 p-md-3">
      
      {% for bill in bills %}
      <div class="card custom-card transaction-item mb-3">
        <div class="card-body p-2 p-sm-3">
          <div class="d-flex align-items-start align-items-md-center flex-column flex-md-row transaction-info">
            <!-- Image/Icon Section -->
            <div class="d-flex align-items-center mb-2 mb-md-0 w-100 w-md-auto">
              {% if bill.upload_folders.first %}
                <img src="{{bill.upload_folders.first.file.url}}" alt="{% trans 'Archivo' %}" class="transaction-image me-3 flex-shrink-0">
              {% else %}
                <div class="transaction-image me-3 flex-shrink-0 d-flex align-items-center justify-content-center bg-light rounded">
                  <i class="ri-file-unknow-line fs-5 text-muted"></i>
                </div>
              {% endif %}
              
              <!-- Info Section -->
              <div class="flex-grow-1 overflow-hidden">
                <h6 class="mb-1 fw-semibold text-break">{{ bill.title }}</h6>
                <p class="text-muted mb-1 fs-12 text-truncate-2">{{ bill.description }}</p>
                <div class="d-flex flex-wrap gap-2 align-items-center">
                  <small class="text-muted">
                    <i class="ri-calendar-line me-1"></i>{{ bill.created_at|date:"d/m/Y" }}
                  </small>
                  {% if bill.due_date %}
                  <small class="text-muted">
                    <i class="ri-time-line me-1"></i>{{ bill.due_date|date:"d/m/Y" }}
                  </small>
                  {% endif %}
                  <small class="text-muted">
                    <i class="ri-building-line me-1"></i><span class="badge bg-purple-transparent">{{ bill.department.name }}</span>
                  </small>
                </div>
              </div>
            </div>
            
            <!-- Amount and Actions Section -->
            <div class="d-flex justify-content-between align-items-center w-100 ms-md-3 mt-2 mt-md-0">
              <div class="text-start text-md-end me-2 me-md-3">
                <div class="transaction-amount expense fw-bold">{{ bill.total_mount }}</div>
                <span class="badge bg-danger-transparent">{{ bill.get_type_display }}</span>
              </div>
              
              <div class="transaction-actions ms-auto">
                <a href="{% url 'app:detail_bill' bill.identifier %}" class="btn btn-sm btn-primary">
                  <i class="ri-eye-line"></i><span class="d-none d-sm-inline ms-1">{% trans "Ver" %}</span>
                </a>
                {% if bill.edit %}
                <a href="{% url 'app:update_bill' bill.identifier %}" class="btn btn-sm btn-primary">
                  <i class="ri-edit-line me-1"></i><span class="d-none d-sm-inline">{% trans "Editar" %}</span>
                </a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="text-center py-5">
        <i class="ri-inbox-line fs-1 text-muted"></i>
        <p class="text-muted mt-3 mb-0">{% trans "No hay gastos disponibles" %}</p>
      </div>
      {% endfor %}

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){

  const totalMountElements = document.querySelectorAll('.transaction-amount');

  totalMountElements.forEach(element => {
    element.textContent = formatNumber(element.textContent.trim());
  })
});

function formatNumber(value){
    value = value.replace(/\./g, '');

    return value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}
</script>
{% endblock %}